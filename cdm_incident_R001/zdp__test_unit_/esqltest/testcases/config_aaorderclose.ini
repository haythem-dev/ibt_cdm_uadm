[general]
database=ich21@zdev21_tcp
separator=;

# --- aorderclose test case: simulate order closing and consolidation operations ---
# Create temp table for orders
[transaction00]
sql=CREATE TABLE ich21@zdev21_tcp:temp_orders (\
    order_id INT,\
    customer_id INT,\
    order_date INT,\
    status VARCHAR(20),\
    total_amount INT\
);

# Insert sample orders
[transaction01]
sql=INSERT INTO ich21@zdev21_tcp:temp_orders (\
    order_id, customer_id, order_date, status, total_amount\
) VALUES (10001, 501, 20240601, 'Open', 500);
[transaction02]
sql=INSERT INTO ich21@zdev21_tcp:temp_orders (\
    order_id, customer_id, order_date, status, total_amount\
) VALUES (10002, 502, 20240602, 'Closed', 700);
[transaction03]
sql=INSERT INTO ich21@zdev21_tcp:temp_orders (\
    order_id, customer_id, order_date, status, total_amount\
) VALUES (10003, 503, 20240603, 'Open', 300);

# Create temp table for consolidation parameters
[transaction04]
sql=CREATE TABLE ich21@zdev21_tcp:temp_consolidation (\
    param_id INT,\
    order_id INT,\
    consolidation_flag INT,\
    consolidation_time INT\
);

# Insert consolidation parameters
[transaction05]
sql=INSERT INTO ich21@zdev21_tcp:temp_consolidation (\
    param_id, order_id, consolidation_flag, consolidation_time\
) VALUES (1, 10001, 1, 1200);
[transaction06]
sql=INSERT INTO ich21@zdev21_tcp:temp_consolidation (\
    param_id, order_id, consolidation_flag, consolidation_time\
) VALUES (2, 10002, 0, 0);
[transaction07]
sql=INSERT INTO ich21@zdev21_tcp:temp_consolidation (\
    param_id, order_id, consolidation_flag, consolidation_time\
) VALUES (3, 10003, 1, 900);

# Complex SELECT: join orders and consolidation parameters
[transaction08]
sql=SELECT (o.order_id || ';' || o.customer_id || ';' || o.order_date || ';' || o.status || ';' || o.total_amount || ';' || c.consolidation_flag || ';' || c.consolidation_time) AS result \
    FROM ich21@zdev21_tcp:temp_orders o \
    LEFT JOIN ich21@zdev21_tcp:temp_consolidation c ON o.order_id = c.order_id \
    ORDER BY o.order_id;
header=OrderID;CustomerID;OrderDate;Status;TotalAmount;ConsolidationFlag;ConsolidationTime
separator=;
limit=10

# Subquery: select open orders with consolidation enabled
[transaction09]
sql=SELECT (order_id || ';' || customer_id || ';' || order_date || ';' || total_amount) AS result \
    FROM ich21@zdev21_tcp:temp_orders \
    WHERE status = 'Open' AND order_id IN (\
        SELECT order_id FROM ich21@zdev21_tcp:temp_consolidation \
        WHERE consolidation_flag = 1\
    ) \
    ORDER BY order_id;
header=OrderID;CustomerID;OrderDate;TotalAmount
separator=;
limit=10

# Drop temp tables
[transaction10]
sql=DROP TABLE ich21@zdev21_tcp:temp_consolidation;
[transaction11]
sql=DROP TABLE ich21@zdev21_tcp:temp_orders;
