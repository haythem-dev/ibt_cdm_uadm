[general]
database=ich21@zdev21_tcp
separator=;

# longtermlackloader test case: simulate article stock loading and statistics
# Create table for articles without stock
[transaction00]
sql=CREATE TABLE ich21@zdev21_tcp:temp_articles_without_stock (\
    article_id INT,\
    article_name VARCHAR(80),\
    lack_reason VARCHAR(40),\
    detected_date INT\
);

# Insert sample articles without stock
[transaction01]
sql=INSERT INTO ich21@zdev21_tcp:temp_articles_without_stock (\
    article_id, article_name, lack_reason, detected_date\
) VALUES (1001, 'Ibuprofen 400mg', 'Out of stock', 20240601);
[transaction02]
sql=INSERT INTO ich21@zdev21_tcp:temp_articles_without_stock (\
    article_id, article_name, lack_reason, detected_date\
) VALUES (1002, 'Paracetamol 500mg', 'Supplier delay', 20240602);
[transaction03]
sql=INSERT INTO ich21@zdev21_tcp:temp_articles_without_stock (\
    article_id, article_name, lack_reason, detected_date\
) VALUES (1003, 'Aspirin 100mg', 'Recall', 20240603);

# Create table for statistics
[transaction04]
sql=CREATE TABLE ich21@zdev21_tcp:temp_lack_statistics (\
    stat_id INT,\
    article_id INT,\
    hits INT\
);

# Insert statistics
[transaction05]
sql=INSERT INTO ich21@zdev21_tcp:temp_lack_statistics (\
    stat_id, article_id, hits\
) VALUES (1, 1001, 5);
[transaction06]
sql=INSERT INTO ich21@zdev21_tcp:temp_lack_statistics (\
    stat_id, article_id, hits\
) VALUES (2, 1002, 2);
[transaction07]
sql=INSERT INTO ich21@zdev21_tcp:temp_lack_statistics (\
    stat_id, article_id, hits\
) VALUES (3, 1003, 1);

# Complex SELECT: join articles and statistics, show reason and hit count
[transaction08]
sql=SELECT (a.article_id || ';' || a.article_name || ';' || a.lack_reason || ';' || s.hits) AS result \
    FROM ich21@zdev21_tcp:temp_articles_without_stock a \
    LEFT JOIN ich21@zdev21_tcp:temp_lack_statistics s ON a.article_id = s.article_id \
    ORDER BY s.hits DESC, a.article_id;
header=ArticleID;ArticleName;LackReason;Hits
separator=;
limit=10

# Subquery: articles with more than average hits
[transaction09]
sql=SELECT (article_id || ';' || article_name || ';' || lack_reason) AS result \
    FROM ich21@zdev21_tcp:temp_articles_without_stock \
    WHERE article_id IN (\
        SELECT article_id FROM ich21@zdev21_tcp:temp_lack_statistics \
        WHERE hits > (SELECT AVG(hits) FROM ich21@zdev21_tcp:temp_lack_statistics)\
    ) \
    ORDER BY article_id;
header=ArticleID;ArticleName;LackReason
separator=;
limit=10

# Drop tables
[transaction10]
sql=DROP TABLE ich21@zdev21_tcp:temp_lack_statistics;
[transaction11]
sql=DROP TABLE ich21@zdev21_tcp:temp_articles_without_stock;
