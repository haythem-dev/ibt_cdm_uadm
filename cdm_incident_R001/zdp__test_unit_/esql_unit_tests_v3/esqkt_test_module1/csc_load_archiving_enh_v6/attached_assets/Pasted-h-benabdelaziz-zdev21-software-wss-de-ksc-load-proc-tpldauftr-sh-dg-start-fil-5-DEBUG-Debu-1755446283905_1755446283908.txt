h.benabdelaziz@zdev21:/software/wss/de/ksc/load/proc # ./tpldauftr.sh -dg -start -fil 5
DEBUG: Debug mode enabled in shell script
DEBUG: CPR Enhancement - Business hours logic active (8-18: previous day, else: current day)
DEBUG: Final process command: /software/wss/de/ksc/load/bin/tpldauftr.bin -dg --business-day-mode enabled -fil 5 -db ode21@zdev21_shm -del 35
=====================================================================================
SH: START /software/wss/de/ksc/load/proc/printStartStop -dg -start -fil 5
=====================================================================================
O 00 17.08.25 17:52:27 pid=60162396 ================================================
O 00 17.08.25 17:52:27 pid=60162396 START
O 00 17.08.25 17:52:27 pid=60162396 ================================================
CPR LOG: Building main kdauftrag query for filial 5
CPR LOG: ARCHIVING START: Filial=5, BusinessDayMode=ENABLED, CutoffDate=NOTSET, H24Mode=DISABLED
CPR LOG: Final main query SQL: select KDAUFTRAG.KDAUFTRAGNR,KDAUFTRAG.KDAUFTRAGSTAT,KDAUFTRAG.IDFNR,KDAUFTRAG.GERAETNAME,KDAUFTRAG.TOURID,KDAUFTRAG.TOURIDALT,KDAUFTRAG.PERSONALNR,KDAUFTRAG.MATCHCODE,KDAUFTRAG.RECHNUNGNR,KDAUFTRAG.FILIALNR,KDAUFTRAG.ETAUFTRAGSCHALTER1,KDAUFTRAG.ETAUFTRAGSCHALTER2,KDAUFTRAG.ETAUFTRAGSCHALTER3,KDAUFTRAG.ETAUFTRAGSCHALTER4,KDAUFTRAG.KDAUFTRAGART,KDAUFTRAG.KOART,KDAUFTRAG.BUCHART,KDAUFTRAG.DATUMVALUTA,KDAUFTRAG.WERTAUFTRAG,KDAUFTRAG.WERTLIEFERUNG,KDAUFTRAG.WERTZEILEN,KDAUFTRAG.ANZPOS,KDAUFTRAG.ANZPOSOB,KDAUFTRAG.ANZPOSLETZTE,KDAUFTRAG.ANZPOSDAFUE,KDAUFTRAG.ANZPOSDAFUEFEHLER,KDAUFTRAG.ANZALPHATEXT,KDAUFTRAG.ANZBTM,KDAUFTRAG.ANZCONTAINER,KDAUFTRAG.ANZBEHAELTWECHSEL,KDAUFTRAG.ANZBEHAELT,KDAUFTRAG.ANZSONDERWANNE,KDAUFTRAG.BEHAELTERGEWICHT,KDAUFTRAG.RABATTBARPROZ,KDAUFTRAG.ZEITENDEAM,KDAUFTRAG.ZEITENDEPM,KDAUFTRAG.LAGERNRRECHNUNG,KDAUFTRAG.AUFTRAGNRKO,KDAUFTRAG.DMOBILPLATZNR,KDAUFTRAG.SKDDEFEKTABSAGEN,KDAUFTRAG.DRUCKPOSITION,KDAUFTRAG.BATCHSCHREIBEN,KDAUFTRAG.BEMERKUNGEN,KDAUFTRAG.KUNDETEXT,KDAUFTRAG.HERKUNFTFILIALE,KDAUFTRAG.NAECHSTETOUR,KDAUFTRAG.LETZTETOUR,KDAUFTRAG.DAFUEAUFTRAGNR,KDAUFTRAG.DAFUEGERAETENAME,KDAUFTRAG.VERTRIEBSZENTRUMNR,KDAUFTRAG.KUNDENNR,KDAUFTRAG.KDAUFTRAGNRFILIALE,KDAUFTRAG.SENDESTATUS,KDAUFTRAG.POOLTYP,KDAUFTRAG.POOLNR,KDAUFTRAG.ZUGRUND,KDAUFTRAG.DATUMAUSLIEFERUNG,KDAUFTRAG.KDAUFTRAGNRORG,KDAUFTRAG.DATUMORG,KDAUFTRAG.KZRESTORED,KDAUFTRAG.BATCHAUFTRAGNR,KDAUFTRAG.SUB_ORDER_TYPE,KDAUFTRAG.PAYMENT_TERM,KDAUFTRAG.ANZAUF,KDAUFTRAG.DATUMVALUTABATCH,KDAUFTRAG.VALUTAMONAUTO,KDAUFTRAG.VALUTAMONMANUELL,KDAUFTRAG.TENDERNO,KDAUFTRAG.DATUMVERSAND,KDAUFTRAG.DATUMBTM,KDAUFTRAG.BTMFORMULARNR,KDAUFTRAG.WERTNETTO,KDAUFTRAG.WERTRABATT,KDAUFTRAG.INVOICENUMBER,KDAUFTRAG.PAYMENTDATE,KDAUFTRAG.PAYMENTTYPE,KDAUFTRAG.ETAUFTRAGSCHALTER5,KDAUFTRAG.ETAUFTRAGSCHALTER6,KDAUFTRAG.DRIVERID,KDAUFTRAG.XMLREFERENCENO,KDAUFTRAG.LOGISTICVOLUME,KDAUFTRAG.ORDERLABEL,KDAUFTRAG.DPODAYS,KDAUFTRAG.ORDERPERIODID,KDAUFTRAG.ORIGINTYPEORG from kdauftrag where vertriebszentrumnr= 5 for update
CPR LOG: Preparing Skdauftrag query...
CPR LOG: Skdauftrag query prepared successfully
CPR LOG: Building fkwarteschlange subquery for filial 5
CPR LOG: Business day mode enabled but cutoff_date not set (0) - no filter applied to subquery
CPR LOG: Final fkwarteschlange query SQL: select * from fkwarteschlange where kdauftragnr in (select kdauftragnr from kdauftrag where vertriebszentrumnr=5) for update
CPR LOG: Preparing Sfkwarteschlange query...
CPR LOG: Sfkwarteschlange query prepared successfully
CPR LOG:
=== CPR BUSINESS DAY ENHANCEMENT INITIALIZATION ===
CPR LOG: Filial Number: 5
CPR LOG: Database: ode21@zdev21_shm
CPR LOG: Days to keep: 35
CPR LOG: Debug mode: ENABLED
CPR LOG: Business day mode status: ENABLED (mode=1, explicit=1)
CPR LOG: Initializing business day enhancement (version 1.0.0)
CPR LOG: Current settings - business_hours_start=8, business_hours_end=18, force_date=0, archive_mode=normal
CPR LOG: === CPR Business Day Calculation Starting ===
CPR LOG: Current Date: 2025-08-17 (Sunday)
CPR LOG: Current Time: 17:52:27
CPR LOG: Day of week: 0 (0=Sunday, 6=Saturday)
CPR LOG: WEEKEND DETECTED: Current day is Sunday
CPR LOG: Business Hours Configuration: 08:00 - 18:00
CPR LOG: Current Hour: 17 (checking against business hours)
CPR LOG: === BUSINESS HOURS LOGIC ===
CPR LOG: Current time 17:52 is within business hours (08:00-18:00)
CPR LOG: Strategy: Archive PREVIOUS business day
CPR LOG: Initial target date: 2025-08-16 (Saturday)
CPR LOG: WEEKEND ROLLBACK: Target is Saturday, rolling back 1 day to Friday
CPR LOG: After weekend rollback: 2025-08-15 (Friday)