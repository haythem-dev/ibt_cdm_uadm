###############################################################################################
# HEADER-DATA
###############################################################################################
#Author: devuser
#Creation-Date:	26.11.2008
#Creation-Time:	15:43
#Purpose:		contains variables specific for the process tpldauftr
#Enhanced:      Business day enhancement with minimal modifications (CPR)
###############################################################################################

#===============================================================================================#
# VARIABLES DEFINITION
#===============================================================================================#

# Original variables
PROCNAME="tpldauftr"
#ADDITIONAL_PARA=""

# CPR Business Day Enhancement: Add business day mode by default
# This enables the enhanced business day logic while preserving backward compatibility
if [[ -z "$business_day_mode" ]]; then
    # Default to enabled mode for business day logic
    ADDITIONAL_PARA="--business-day-mode enabled"
else
    ADDITIONAL_PARA="--business-day-mode ${business_day_mode}"
fi

# If specific business day parameters are provided via command line, they take precedence
# The assembling_process function will handle the proper parameter ordering

export ADDITIONAL_PARA

# Enhanced: Business Day Configuration
BUSINESS_DAY_CUTOFF_HOUR=6
BUSINESS_DAY_MODE="enabled"
BUSINESS_DAY_WEEKEND_ROLLBACK="enabled"

# Enhanced: Logging Configuration
BUSINESS_DAY_LOG_LEVEL="INFO"
BUSINESS_DAY_DEBUG="false"

# Enhanced: Runtime Configuration
TPLDAUFTR_ENHANCED_MODE="true"
TPLDAUFTR_ORIGINAL_FALLBACK="false"

#===============================================================================================#
# ENVIRONMENT SPECIFIC OVERRIDES
#===============================================================================================#

# Development environment settings
if [[ "${ENVIRONMENT}" == "DEV" || "${ENVIRONMENT}" == "TEST" ]]; then
    BUSINESS_DAY_DEBUG="true"
    BUSINESS_DAY_LOG_LEVEL="DEBUG"
fi

# Production environment settings
if [[ "${ENVIRONMENT}" == "PROD" ]]; then
    BUSINESS_DAY_DEBUG="false"
    BUSINESS_DAY_LOG_LEVEL="INFO"
fi

#===============================================================================================#
# COUNTRY SPECIFIC CONFIGURATIONS
#===============================================================================================#

# Default business hours configuration for all countries
# Can be overridden per country if needed
case "${COUNTRY_CODE}" in
    "AT"|"BG"|"CH"|"DE"|"FR"|"HR")
        BUSINESS_DAY_CUTOFF_HOUR=6
        BUSINESS_DAY_WEEKEND_ROLLBACK="enabled"
        ;;
    *)
        BUSINESS_DAY_CUTOFF_HOUR=6
        BUSINESS_DAY_WEEKEND_ROLLBACK="enabled"
        ;;
esac

#===============================================================================================#
# RUNTIME PARAMETER ASSEMBLY
#===============================================================================================#

# Function to get current business day parameters
function get_business_day_parameters() {
    local _params=""

    if [[ "${BUSINESS_DAY_MODE}" == "enabled" ]]; then
        _params="${_params} --enable-business-day"
    else
        _params="${_params} --disable-business-day"
    fi

    if [[ "${BUSINESS_DAY_DEBUG}" == "true" ]]; then
        _params="${_params} --debug"
    fi

    echo "${_params}"
}

# Export configuration for use by calling scripts
export BUSINESS_DAY_CUTOFF_HOUR
export BUSINESS_DAY_MODE
export BUSINESS_DAY_WEEKEND_ROLLBACK
export BUSINESS_DAY_LOG_LEVEL
export BUSINESS_DAY_DEBUG
export TPLDAUFTR_ENHANCED_MODE
export TPLDAUFTR_ORIGINAL_FALLBACK

#===============================================================================================#
# VALIDATION
#===============================================================================================#

# Validate business day configuration
if [[ ! "${BUSINESS_DAY_CUTOFF_HOUR}" =~ ^[0-9]+$ ]] || [[ "${BUSINESS_DAY_CUTOFF_HOUR}" -lt 0 ]] || [[ "${BUSINESS_DAY_CUTOFF_HOUR}" -gt 23 ]]; then
    echo "WARNING: Invalid BUSINESS_DAY_CUTOFF_HOUR: ${BUSINESS_DAY_CUTOFF_HOUR}. Using default: 6"
    BUSINESS_DAY_CUTOFF_HOUR=6
fi

if [[ "${BUSINESS_DAY_MODE}" != "enabled" && "${BUSINESS_DAY_MODE}" != "disabled" ]]; then
    echo "WARNING: Invalid BUSINESS_DAY_MODE: ${BUSINESS_DAY_MODE}. Using default: enabled"
    BUSINESS_DAY_MODE="enabled"
fi

echo "INFO: tpldauftr.vars loaded with business day configuration:"
echo "INFO: - Business Day Mode: ${BUSINESS_DAY_MODE}"
echo "INFO: - Cutoff Hour: ${BUSINESS_DAY_CUTOFF_HOUR}"
echo "INFO: - Weekend Rollback: ${BUSINESS_DAY_WEEKEND_ROLLBACK}"
echo "INFO: - Debug Mode: ${BUSINESS_DAY_DEBUG}"