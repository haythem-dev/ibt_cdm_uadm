SELECT 
    'STANDARD MODE' as execution_mode,
    'Date-based archiving (no H24 flags)' as description,
    filialnr as branch_number,   
    -- Branch name lookup (add branch names for better readability)
    CASE filialnr
        WHEN 5 THEN 'VZ Fuerth DEV'
        WHEN 59 THEN 'Vertriebszentrum Cottbus'
        WHEN 40 THEN 'Vertriebszentrum Bielefeld'
        WHEN 6 THEN 'Vertriebszentrum Berlin'
        WHEN 31 THEN 'Vertriebszentrum Hamburg'
        WHEN 33 THEN 'Vertriebszentrum Weser-Ems'
        WHEN 9 THEN 'Vertriebszentrum Herne'
        WHEN 108 THEN 'Vertriebszentrum Muenster'
        WHEN 46 THEN 'Vertriebszentrum Koeln'
        WHEN 70 THEN 'Vertriebszentrum Goettingen'
        WHEN 78 THEN 'Vertriebszentrum Hannover'
        WHEN 99 THEN 'Pseudofiliale zur Ueberwachung'
        WHEN 56 THEN 'Vertriebszentrum Hanau'
        WHEN 21 THEN 'Hageda Stumpf'
        WHEN 44 THEN 'DEV - Augsburg'
        WHEN 57 THEN 'Vertriebszentrum Muenchen'
        WHEN 51 THEN 'Vertriebszentrum Mannheim'
        WHEN 52 THEN 'Vertriebszentrum Neuhausen'
        WHEN 58 THEN 'Vertriebszentrum Freiburg'
        WHEN 54 THEN 'Vertriebszentrum Bad Kreuznach'
        WHEN 81 THEN 'Vertriebszentrum Leipzig'
        WHEN 82 THEN 'Vertriebszentrum Gotha'
        ELSE 'Unknown Branch'
    END as branch_name,  
    COUNT(*) as orders_to_be_archived,
    kdauftragstat, 
    -- Status breakdown for analysis
    SUBSTR(kdauftragstat, 1, 4) as primary_status,
    SUBSTR(kdauftragstat, 5, 1) as erfasst_flag,
    SUBSTR(kdauftragstat, 9, 1) as h24_complete_flag,
    SUBSTR(kdauftragstat, 10, 1) as h24_cancel_flag,  
    -- Reason for archiving/rejection
    CASE 
        WHEN SUBSTR(kdauftragstat, 1, 4) != '0000' THEN 'REJECTED: Invalid Primary Status'
        WHEN SUBSTR(kdauftragstat, 5, 1) = '1' THEN 'REJECTED: Erfasst Flag Active'
        ELSE 'ELIGIBLE: Standard Date Logic Applied'
    END as archive_reason   
FROM kdauftrag
WHERE 
    filialnr IN (5,59,40,6,31,33,9,108,46,70,78,99,56,21,44,57,51,52,58,54,81,82)
    AND datumauslieferung > 0
    AND datumauslieferung <= 20250815  -- Business day cutoff
    -- Script validation conditions:
    AND SUBSTR(kdauftragstat, 1, 4) = '0000'  -- Primary status must be "0000"
    AND SUBSTR(kdauftragstat, 5, 1) != '1'    -- Not "Erfasst" 
    -- NO H24 flag conditions in standard mode  
GROUP BY filialnr, kdauftragstat
ORDER BY filialnr, kdauftragstat;